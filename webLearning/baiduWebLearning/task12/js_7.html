<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=gb2312" />
<title>我是精明的小卖家（一）</title>
<style>
	#div-show thead td,#tbody-show tr th{
		border:1px solid #CCCCCC;
		width:50px;
		height:40px;
		text-align:center;
		line-height:50px;
	}
	#tbody-show tr th:nth-child(1),#tbody-show tr th:nth-child(2),#div-show tr th:nth-child(1),#div-show tr th:nth-child(2){
		width:100px;
	}
	#data-show,#form-show{
		margin-bottom:30px;
	};
	
	table{
		border-collapse:collapse;
	}
</style>
</head>

<body>
	<div id="select-region">
		选择查询的区域： 
		<label><input name="region" type="checkbox" value="" checked="checked" disabled="disabled"/>华东</label>
		<label><input name="region" type="checkbox" value="" />华南</label>
		<label><input name="region" type="checkbox" value="" />华北</label>
		<label><input name="region" type="checkbox" value="" />全选</label>
	</div>
	<div id="select-product">
		选择查询的商品： 
		<label><input name="region" type="checkbox" value="" checked="checked" disabled="disabled"/>手机</label>
		<label><input name="region" type="checkbox" value="" />笔记本</label>
		<label><input name="region" type="checkbox" value="" />智能音箱</label>
		<label><input name="region" type="checkbox" value="" />全选</label>
	</div>

	<div id='form-show'><strong>表格显示</strong><button type="button" id="btn1">显示/隐藏</button>
		<table id='div-show'>
			<thead>
				<tr>
					<td>产品</td><td>地区</td><td>1月</td><td>2月</td>
					<td>3月</td><td>4月</td><td>5月</td><td>6月</td>
					<td>7月</td><td>8月</td><td>9月</td><td>10月</td>
					<td>11月</td><td>12月</td>
				</tr>
			</thead>
			<tbody id='tbody-show'>
			</tbody>
		</table>
	</div>
	<strong>数据显示</strong><button type="button" id="btn2">显示/隐藏</button>
	<div id='data-show'>
		<p>手机 华东 120,100,140,160,180,185,190,210,230,245,255,270</p>
	</div>
<script>
	let sourceData = [
		{
		product: "手机",
		region: "华东",
		sale: [120, 100, 140, 160, 180, 185, 190, 210, 230, 245, 255, 270]
		}, {
		product: "手机",
		region: "华北",
		sale: [80, 70, 90, 110, 130, 145, 150, 160, 170, 185, 190, 200]
		}, {
		product: "手机",
		region: "华南",
		sale: [220, 200, 240, 250, 260, 270, 280, 295, 310, 335, 355, 380]
		}, {
		product: "笔记本",
		region: "华东",
		sale: [50, 60, 80, 110, 30, 20, 70, 30, 420, 30, 20, 20]
		}, {
		product: "笔记本",
		region: "华北",
		sale: [30, 35, 50, 70, 20, 15, 30, 50, 710, 130, 20, 20]
		}, {
		product: "笔记本",
		region: "华南",
		sale: [80, 120, 130, 140, 70, 75, 120, 90, 550, 120, 110, 100]
		}, {
		product: "智能音箱",
		region: "华东",
		sale: [10, 30, 4, 5, 6, 5, 4, 5, 6, 5, 5, 25]
		}, {
		product: "智能音箱",
		region: "华北",
		sale: [15, 50, 15, 15, 12, 11, 11, 12, 12, 14, 12, 40]
		}, {
		product: "智能音箱",
		region: "华南",
		sale: [10, 40, 10, 6, 5, 6, 8, 6, 6, 6, 7, 26]
	}];
	var selectRegions=document.querySelectorAll('#select-region input');
	var selectRegion=document.querySelector('#select-region');
	var selectProduct=document.querySelector('#select-product');
	var selectProducts=document.querySelectorAll('#select-product input');
	var dataShow=document.querySelector('#data-show');
	var divShow=document.querySelector('#div-show');
	var trs=document.querySelectorAll('#tbody-show tr');
	var tbodyShow=document.querySelectorAll('#tbody-show');
	var l=document.querySelector('#div-show thead tr');
	var btn1=document.querySelector('#btn1');
	var btn2=document.querySelector('#btn2');
	//
	divShow.style.display='block';
	dataShow.style.display='block';
	btn1.onclick=function(){
		if(divShow.style.display=='none'){
			divShow.style.display='block';
		}else{
			divShow.style.display='none';
		};
	};
	btn2.onclick=function(){
		if(dataShow.style.display=='none'){
			dataShow.style.display='block';
		}else{
			dataShow.style.display='none';
		};
	};
	//
	var regionArr1=new Array();
	var regionArr2=new Array();
	var regionArr3=new Array();
	for(let i=0;i<sourceData.length;i++){//根据地区分为三组数据
		if(sourceData[i].region=='华东'){
			regionArr1.push(sourceData[i]);
		}else if(sourceData[i].region=='华南'){
			regionArr2.push(sourceData[i]);
		}else{
			regionArr3.push(sourceData[i]);
		};
		
	};
	var objArr={
		0:regionArr1,
		1:regionArr2,
		2:regionArr3
	};
	var sale1=[];
	var sale2=[];
	var sale3=[];
	for(let j=0;j<regionArr1.length;j++){
		sale1.push(regionArr1[j].sale);
		sale2.push(regionArr2[j].sale);
		sale3.push(regionArr3[j].sale);
	};


	
	//checked 部分
	for(let i=0;i<selectRegions.length;i++){//创建委托事件
		if(i==selectRegions.length-1){
			selectRegions[i].addEventListener('click',function(){
				allChecked();
				unChecked();
				textShow();
			});
			selectProducts[i].addEventListener('click',function(){
				allChecked();
				unChecked();
				textShow();
			});
		}else{
			selectRegions[i].addEventListener('click',function(){
				unChecked();
				textShow();

			});
			selectProducts[i].addEventListener('click',function(){
				unChecked();
				textShow();
				
			});
		}
	};
	function allChecked(){//全选按钮触发事件
		if(selectRegions[3].checked){//点击全选按钮，所有选项被选中
			for(let i=0;i<selectRegions.length-1;i++){
				selectRegions[i].checked=true;
			};
		};
		if(selectProducts[3].checked){
			for(let i=0;i<selectProducts.length-1;i++){
				selectProducts[i].checked=true;
			};
		};
		if((selectRegions[3].checked)&&(selectProducts[3].checked)){
			allShow();
			
		};
	};
	function unChecked(){//根据勾选的个数决定全选复选框是否选中
		let index=0;
		let index1=0;
		for(let i=0;i<selectProducts.length-1;i++){
			selectProducts[i].disabled=false;
			selectRegions[i].disabled=false;
			if(selectProducts[i].checked){
				index++;
				var m=i;
			};
			if(selectRegions[i].checked){
				index1++;
				var n=i;
			};
		};
		if(index==1){//只有一个选中时不允许取消
			selectProducts[m].disabled=true;
		};
		if(index1==1){
			selectRegions[n].disabled=true;
		};
		if(index!==3){//只有全部选中，全选框才选中
			selectProducts[3].checked=false;
		}else{
			selectProducts[3].checked=true;
		};
		if(index1!==3){
			selectRegions[3].checked=false;
		}else{
			selectRegions[3].checked=true;
		};
	};
	
	
	//添加表格内容
	function allShow(){//全选框都选中时，显示全部内容
		dataShow.innerHTML='';
		var trs=document.querySelectorAll('#tbody-show tr');
		var tbodyShow=document.getElementById('tbody-show');
		for(let i=0;i<trs.length;i++){
			if(trs.length!==0){
				tbodyShow.innerHTML='';
			};
		};
		
		for(let i in objArr){
			for(let j=0;j<regionArr1.length;j++){
				let p=document.createElement('p');
				p.innerHTML=objArr[i][j].product+' '+objArr[i][j].region+' '+objArr[i][j].sale;//数据显示
				dataShow.appendChild(p);
				let tr=document.createElement('tr');
				tbodyShow.appendChild(tr);
				let trs=document.querySelectorAll('#tbody-show tr');
				let q=regionsNum(i,j)
				for(let x=0;x<14;x++){
					let th=document.createElement('th');
					trs[q].appendChild(th);
				};
				trs[q].children[0].innerHTML=objArr[i][j].product;//表格显示
				trs[q].children[1].innerHTML=objArr[i][j].region;
				for(let k=2;k<14;k++){
					trs[q].children[k].innerHTML=objArr[i][j].sale[k-2];	
				};
			};
			
		};
	};
	function regionsNum(i,j){
		if(i==0){
			var q=j;
		}else if(i==1){
			var q=j+3;
		}else{
			var q=j+6;
		};
		return q;
	};
	//不同复选框显示不同的内容
	function checkedNum(){
		let regionNum=0;
		let productNum=0;
		for(let i=0;i<selectRegions.length-1;i++){
			if(selectRegions[i].checked){
				regionNum++;
			}
		};
		for(let j=0;j<selectProducts.length-1;j++){
			if(selectProducts[j].checked){
				productNum++;
			}
		};
		return [regionNum,productNum];
	};
	function addtext(){
		let tr=document.createElement('tr');
		tbodyShow.appendChild(tr);
		let trs=document.querySelectorAll('#tbody-show tr');
		for(let x=0;x<14;x++){
			let th=document.createElement('th');
			trs[trs.length-1].appendChild(th);
		};
		for(let k=2;k<14;k++){
			trs[trs.length-1].children[k].innerHTML=objArr[i][j].sale[k-2];	
		};
		return trs;
	};
	function textShow(){
		let num=checkedNum();
		for(let i=0;i<selectRegions.length-1;i++){
			for(let j=0;j<selectProducts.length-1;j++){
				let dataP=document.querySelectorAll('#data-show p');
				let inner=objArr[i][j].product+' '+objArr[i][j].region+' '+objArr[i][j].sale;
				let trs=document.querySelectorAll('#tbody-show tr');
				let tbodyShow=document.getElementById('tbody-show');
				if(selectRegions[i].checked){//区域选中
					let str=dataShow.innerHTML;
					let ind=str.indexOf(inner);
					let q=regionsNum(i,j);
					if(selectProducts[j].checked){//商品选中时显示
						if(ind==-1){//数据显示
							let p=document.createElement('p');
							p.innerHTML=inner;
							dataShow.appendChild(p);
						}; 
						let index=0;
						for(let k=0;k<trs.length;k++){//表格显示
						    let innerSale0=objArr[i][j].sale
							let innerSale=innerSale0.join('');
							let trsText=trs[k].innerText.replace(/\s/g,'')
							if(trsText.indexOf(innerSale)==-1){
								index++;
							};
						};
						if(index==trs.length){//若原来不存在该信息则添加
								let tr=document.createElement('tr');
								tbodyShow.appendChild(tr);
								let trs=document.querySelectorAll('#tbody-show tr');
								for(let x=0;x<14;x++){
									let th=document.createElement('th');
									trs[trs.length-1].appendChild(th);
								};
								trs[trs.length-1].children[0].innerHTML=objArr[i][j].product;
								trs[trs.length-1].children[1].innerHTML=objArr[i][j].region;
								for(let k=2;k<14;k++){
									trs[trs.length-1].children[k].innerHTML=objArr[i][j].sale[k-2];	
								};
							
							
						};
					}else{//商品没有选中时删除商品信息
						let trs=document.querySelectorAll('#tbody-show tr');
						for(let k=0;k<dataP.length;k++){
							if(dataP[k].innerHTML.indexOf(inner)!==-1){
								dataShow.removeChild(dataP[k]);
							};
						};
						for(let k=0;k<trs.length;k++){
							let a=trs[k].children[0].innerHTML;
							let b=trs[k].children[1].innerHTML;
							let c=objArr[i][j].region;
							let d=objArr[i][j].product;
							if(((a==c)&&(b==d))||((a==d)&&(b==c))){
								tbodyShow.removeChild(trs[k]);
							};
						};						
					};
				}else{//区域没有选中时删除商品信息
					for(let k=0;k<dataP.length;k++){
						if(dataP[k].innerHTML.indexOf(inner)!==-1){
							dataShow.removeChild(dataP[k]);
						};
					};
					let trs=document.querySelectorAll('#tbody-show tr');
					for(let k=0;k<trs.length;k++){
						let a=trs[k].children[0].innerHTML;
						let b=trs[k].children[1].innerHTML;
						if((a==objArr[i][j].region)||(b==objArr[i][j].region)){
							tbodyShow.removeChild(trs[k]);
						};
					};	
				};
				
			};
			
		};
		let trs=document.querySelectorAll('#tbody-show tr');
		if((num[0]==1)&&(num[1]>1)){
			for(let k=0;k<trs.length;k++){
				if(trs[k]){
					let inn=trs[k].children[0].innerHTML;
					if(inn=='手机'||inn=='笔记本'||inn=='智能音箱'){
						trs[k].children[0].innerHTML=trs[k].children[1].innerHTML;
						trs[k].children[1].innerHTML=inn;
						l.children[0].innerHTML='区域';
						l.children[1].innerHTML='产品';
					};
				};
			};
		}else{
			for(let k=0;k<trs.length;k++){
				if(trs[k]){
					let inn=trs[k].children[0].innerHTML;
					if(inn=='华东'||inn=='华南'||inn=='华北'){
						trs[k].children[0].innerHTML=trs[k].children[1].innerHTML;
						trs[k].children[1].innerHTML=inn;
						l.children[0].innerHTML='产品';
						l.children[1].innerHTML='区域';
					};
				};
			};
		};
	};
</script>
</body>
</html>
